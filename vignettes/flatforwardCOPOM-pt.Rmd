---
title: Interpolação flat-forward nas reuniões do COPOM
bibliography: references.bib
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Resumo

O objetivo deste artigo é apresentar uma metodologia para a interpolação de uma
curva de juros considerando as datas de reuniões do Comitê de Política
Monetária (COPOM) como vértices e consequentemente o seu efeito nas taxas
de juros de 1 dia a termo.


## Introdução

A estrutura a termo de juros prefixados utilizada no Brasil se apresenta de
duas formas, sem caixa e com caixa, a primeira é formada com base nos contratos
futuros de Taxa DI (DI1) negociados na B3.
A segunda versão pode ser extraída dos títulos públicos prefixados, negociados
no Tesouro Direto e que têm preços de referência divulgados na ANBIMA.
A versão mais utilizada é a sem caixa, formada a partir dos contratos futuros
de DI1.
Dessa maneira, os vértices da curva correspondem aos vencimentos dos contratos
futuros.

O método de interpolação flat-forward [@hagan2006interpolation] é comumente
utilizado para interpolar a curva de juros prefixados, e a interpolação é
realizada a partir dos vencimentos dos futuros.
Entretanto, na parte curta da curva, tipicamente dentro do primeiro ano,
a dinâmica dos juros é determinada pelo COPOM.
No gráfico abaixo temos um histórico da taxa de juros SELIC Meta
definida pelo COPOM.
O histórico vai de fevereiro de 2021 a fevereiro de 2022 e compreende 8 reuniões
do comitê.
No gráfico a taxa de juros SELIC Meta definida está em azul e as datas das
reuniões são representadas pelas linhas tracejadas em vermelho.
Observando o gráfico com a SELIC Meta fica evidente que a dinâmica das taxas
de juros de curto prazo é determinada pelo COPOM.

```{r seta-plot, fig.cap="Taxa de juros SELIC Meta."}
library(flatforwardCOPOM)

refdate <- as.Date("2021-02-01")
seta <- rbcb::get_series(c(SELIC = 432),
  start_date = refdate,
  end_date = "2022-02-23"
)
du <- bizdays(refdate, seta$date, "Brazil/ANBIMA")
plot(du, seta$SELIC,
  type = "l", col = "blue",
  xlab = "Dias úteis", ylab = "Taxa de Juros (%)",
  main = "Taxa de juros - Meta Selic definida pelo Copom"
)
dates <- get_copom_dates("2021-02-01", 8)
copom_du <- bizdays(refdate, dates, "Brazil/ANBIMA")
abline(v = copom_du, lty = "dashed", col = "red")
```

O COPOM reune-se periodicamente para definir o nível da taxa SELIC que por sua
vez influencia a taxa DI, utilizada no mercado interbancário.
Dessa maneira, é esperado que esta taxa DI mude de nível após as reuniões do
Comitê.
Contudo, aplicando a interpolação flat-forward a curva de juros com vencimentos
dos futuros e calculando as taxas a termo de 1 dia, observa-se que as mudanças
de nível nas taxas de juros, geradas pela interpolação,
ocorrem após cada vértice de vencimento de futuros.
Portanto, temos que, para o curto prazo, a interpolação cria um comportamento
diferente do que é observado.
Assim, é necessário realizar uma interpolação flat-forward, para a parte curta
da curva, considerando as reuniões do COPOM [@carreira2016brazilian],
fazendo com que as taxas de juros a termo fiquem constante entre as reuniões.

Vamos construir um exemplo com a curva de juros prefixados para a data de
referência 23/02/2022.
Neste exemplo vamos construir uma estrutura a termo de juros a vista
(classe `spotratecurve`) e definir a interpolação *flat-forward* para essa
curva.
Em seguida vamos calcular as taxas de juros a termo de 1 dia e visualizar em
um gráfico as mudanças de nível nas taxas a termo junto com as datas de reuniões
do COPOM.

```{r curve, message=FALSE, warning=FALSE}
library(fixedincome)

refdate <- as.Date("2022-02-23")
terms <- c(1, 3, 25, 44, 66, 87, 108, 131, 152, 172, 192, 214, 236, 277)
rates <- c(
  0.1065, 0.1064, 0.111, 0.1138, 0.1168, 0.1189, 0.1207, 0.1219,
  0.1227, 0.1235, 0.1234, 0.1236, 0.1235, 0.1235
)
curve <- spotratecurve(
  rates, terms, "discrete", "business/252", "Brazil/ANBIMA",
  refdate = refdate
)
interpolation(curve) <- interp_flatforward()
```

Aqui criamos a estrutura a termo e abaixo construímos o gráfico com as taxas de
juros a termo de 1 dia (linha azul) e destacamos as datas de reuniões do
comitê (linhas pontilhadas em vermelho).

```{r}
fwd_curve <- curve[[1:277]] |> forwardrate()
plot(1:277, fwd_curve * 100,
  type = "l", col = "blue",
  xlab = "Dias úteis", ylab = "Taxa de Juros (%)",
  main = "Curva de Juros Diários a Termo"
)
dates <- get_copom_dates(refdate)
copom_du <- bizdays(refdate, dates, "Brazil/ANBIMA")
abline(v = copom_du, lty = "dashed", col = "red")
```

No gráfico observa-se que as mudanças de nível das taxas a termo ocorrem entre
duas reuniões, o que sabemos que não é o comportamento esperado para taxas no
curto prazo.
Em alguns casos, entre as duas primeiras reuniões, temos duas mudanças de nível
entre as reuniões.

Dessa maneira buscam-se formas de realizar uma interpolação que, na parte curta
da curva, as taxas a termo apresentem mudança de nível apenas nas reuniões do
comitê.

Vamos considerar as reuniões que acontecem no horizonte de um
ano nesta abordagem, e dado que estas reuniões acontecem a cada 45 dias,
aproximadamente, teremos 8 reuniões em média neste intervalo.

Esta metodologia foi abordada em [@carreira2016brazilian], onde os contratos
futuros são considerados da curva de juros a interpolação considerando as
reuniões se baseia nas relações de não arbitragem das taxas a termo e
[@varga2020fitting] utiliza contratos de
títulos públicos prefixados em um processo de otimização que
visa minimizar o erro no apreçamento destes contratos utilizando uma estrutura
a termo que apresenta mudança de nível nas reuniões.

O objetivo aqui é trazer a implementação destas abordagens, trazendo a luz as
peculiaridades que se apresentam e as eventuais alternativas para contorná-las.

Na próxima sessão será apresentada a metodologia de interpolação *flat-forward*
e a extensão que considera as reuniões do COPOM, os casos particulares e as
alternativas de solução.
A sessão seguinte aborda o processo que minimiza do erro de apreçamento dos
títulos públicos e adicionalmente submete-se a este processo os contratos
futuros, com o objetivo de comparar com a metodologia anterior.
No fim temos a comparação dos resultados das diferentes abordagens e a
conclusão.

## Interpolação *flat-forward*

A interpolação flat-forward considera que a taxa a termo entre dois vértices
é constante, por isso *flat-forward*.

Sejam os vértices $t_1$ e $t_2$ ($t_2 > t_1$) com as respectivas taxas de juros
a vista $r_1$ e $r_2$.
A taxa de juros a termo $r_{12}$ entre os vértices $t_1$ e $t_2$ é obtida da
equação:

$$
(1 + r_{12})^{t_2 - t_1} = \frac{(1 + r_{2})^{t_2}}{(1 + r_{1})^{t_1}}
$$

De acordo com essa abordagem, para se obter uma taxa a vista $r$ em um vértice
$t$, tal que $t_1 < t < t_2$, considera-se a composição da taxa a vista em
$t_1$ com a taxa $r_{12}$ entre $t_1$ e $t$.

$$
(1 + r)^t = (1 + r_{2})^{t_2} (1 + r_{12})^{t - t_1}
$$

consequentemente

$$
r = \left( (1 + r_{2})^{t_2} (1 + r_{12})^{t - t_1} \right)^{\frac{1}{t}} - 1
$$

Seguindo essa metodologia, o valor das taxas a termo de 1 dia entre os vértices
$t_1$ e $t_2$ é $r_{12}$, uma vez que:

$$
(1 + r_{12})^{t_2 - t_1} = \prod_{i = t_1}^{t_2} (1 + r_{12})
$$

O desafio aqui é construir uma interpolação *flat-forward* entre as datas do
COPOM que, de preferência, mantenha as taxas a vista nos vencimentos dos
futuros.
De forma que o valor obtido dessa nova interpolação nos vencimentos dos
futuros seja igual, ou muito próximo, às taxas a vista dos futuros.
Veremos que não é possível garantir isso para todos os vértices e para lidar
com estes casos particulares seram propostas diferentes abordagens cada uma
com sua motivação.

Para construir uma interpolação *flat-forward* entre as reuniões do COPOM
será proposta uma metodologia que reconstroi a estrutura a termo a vista
compondo as taxas a termo de 1 dia.
Dessa maneira a estrutura a termo é construída a cada reunião considerando as
taxas compostas até a última reunião.
Na próxima sessão será abordada a construção dessa interpolação trecho a trecho
começando pela taxa DI de 1 dia até a última reunião considerada no horizonte
de análise.

## Interpolação *flat-forward* entre reuniões do COPOM

### O começo

Tudo começa na taxa DI de 1 dia.

## Referências